import QRCodeStyling from"qr-code-styling";class BitcoinPay{constructor(){this.version="1.0.0",this.defaultConfig={width:200,height:200,showCopyButton:!0,copyButtonText:"Copy",copiedText:"Copied!",cacheDuration:6e5,qrCodeOptions:{type:"canvas",bitcoinImage:"data:image/svg+xml;base64,PHN2ZyB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgaGVpZ2h0PSI2NCIgd2lkdGg9IjY0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDA2MzA4NzYsLTAuMDAzMDE5ODQpIj4KPHBhdGggZmlsbD0iI2Y3OTMxYSIgZD0ibTYzLjAzMywzOS43NDRjLTQuMjc0LDE3LjE0My0yMS42MzcsMjcuNTc2LTM4Ljc4MiwyMy4zMDEtMTcuMTM4LTQuMjc0LTI3LjU3MS0yMS42MzgtMjMuMjk1LTM4Ljc4LDQuMjcyLTE3LjE0NSwyMS42MzUtMjcuNTc5LDM4Ljc3NS0yMy4zMDUsMTcuMTQ0LDQuMjc0LDI3LjU3NiwyMS42NCwyMy4zMDIsMzguNzg0eiIvPgo8cGF0aCBmaWxsPSIjRkZGIiBkPSJtNDYuMTAzLDI3LjQ0NGMwLjYzNy00LjI1OC0yLjYwNS02LjU0Ny03LjAzOC04LjA3NGwxLjQzOC01Ljc2OC0zLjUxMS0wLjg3NS0xLjQsNS42MTZjLTAuOTIzLTAuMjMtMS44NzEtMC40NDctMi44MTMtMC42NjJsMS40MS01LjY1My0zLjUwOS0wLjg3NS0xLjQzOSw1Ljc2NmMtMC43NjQtMC4xNzQtMS41MTQtMC4zNDYtMi4yNDItMC41MjdsMC4wMDQtMC4wMTgtNC44NDItMS4yMDktMC45MzQsMy43NXMyLjYwNSwwLjU5NywyLjU1LDAuNjM0YzEuNDIyLDAuMzU1LDEuNjc5LDEuMjk2LDEuNjM2LDIuMDQybC0xLjYzOCw2LjU3MWMwLjA5OCwwLjAyNSwwLjIyNSwwLjA2MSwwLjM2NSwwLjExNy0wLjExNy0wLjAyOS0wLjI0Mi0wLjA2MS0wLjM3MS0wLjA5MmwtMi4yOTYsOS4yMDVjLTAuMTc0LDAuNDMyLTAuNjE1LDEuMDgtMS42MDksMC44MzQsMC4wMzUsMC4wNTEtMi41NTItMC42MzctMi41NTItMC42MzdsLTEuNzQzLDQuMDE5LDQuNTY5LDEuMTM5YzAuODUsMC4yMTMsMS42ODMsMC40MzYsMi41MDMsMC42NDZsLTEuNDUzLDUuODM0LDMuNTA3LDAuODc1LDEuNDM5LTUuNzcyYzAuOTU4LDAuMjYsMS44ODgsMC41LDIuNzk4LDAuNzI2bC0xLjQzNCw1Ljc0NSwzLjUxMSwwLjg3NSwxLjQ1My01LjgyM2M1Ljk4NywxLjEzMywxMC40ODksMC42NzYsMTIuMzg0LTQuNzM5LDEuNTI3LTQuMzYtMC4wNzYtNi44NzUtMy4yMjYtOC41MTUsMi4yOTQtMC41MjksNC4wMjItMi4wMzgsNC40ODMtNS4xNTV6bS04LjAyMiwxMS4yNDljLTEuMDg1LDQuMzYtOC40MjYsMi4wMDMtMTAuODA2LDEuNDEybDEuOTI4LTcuNzI5YzIuMzgsMC41OTQsMTAuMDEyLDEuNzcsOC44NzgsNi4zMTd6bTEuMDg2LTExLjMxMmMtMC45OSwzLjk2Ni03LjEsMS45NTEtOS4wODIsMS40NTdsMS43NDgtNy4wMWMxLjk4MiwwLjQ5NCw4LjM2NSwxLjQxNiw3LjMzNCw1LjU1M3oiLz4KPC9nPgo8L3N2Zz4K",lightningImage:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgyIiBoZWlnaHQ9IjI4MiIgdmlld0JveD0iMCAwIDI4MiAyODIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMCkiPgo8Y2lyY2xlIGN4PSIxNDAuOTgzIiBjeT0iMTQxLjAwMyIgcj0iMTQxIiBmaWxsPSIjN0IxQUY3Ii8+CjxwYXRoIGQ9Ik03OS43NjA5IDE0NC4wNDdMMTczLjc2MSA2My4wNDY2QzE3Ny44NTcgNjAuNDIzNSAxODEuNzYxIDYzLjA0NjYgMTc5LjI2MSA2Ny41NDY2TDE0OS4yNjEgMTI2LjU0N0gyMDIuNzYxQzIwMi43NjEgMTI2LjU0NyAyMTEuMjYxIDEyNi41NDcgMjAyLjc2MSAxMzMuNTQ3TDExMC4yNjEgMjE1LjA0N0MxMDMuNzYxIDIyMC41NDcgOTkuMjYxIDIxNy41NDcgMTAzLjc2MSAyMDkuMDQ3TDEzMi43NjEgMTUxLjU0N0g3OS43NjA5Qzc5Ljc2MDkgMTUxLjU0NyA3MS4yNjA5IDE1MS41NDcgNzkuNzYwOSAxNDQuMDQ3WiIgZmlsbD0id2hpdGUiLz4KPC9nPgo8ZGVmcz4KPGNsaXBQYXRoIGlkPSJjbGlwMCI+CjxyZWN0IHdpZHRoPSIyODIiIGhlaWdodD0iMjgyIiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo="}}}static async render(t){const{endpoint:i,element:n,lightning:e,fallbackAddress:a,options:o={}}=t;if(!i)throw new Error("BitcoinPay: endpoint is required");if(!a)throw new Error("BitcoinPay: fallbackAddress is required");if(!n)throw new Error("BitcoinPay: element selector is required");const c=document.querySelector(n);if(!c)throw new Error(`BitcoinPay: element "${n}" not found`);const s=new BitcoinPay,d={...s.defaultConfig,...o},M=s.generateInstanceId(),r=btoa(unescape(encodeURIComponent(i))).replace(/[^a-zA-Z0-9]/g,""),l=`btc-address-${r}`,y=`btc-timestamp-${r}`;try{const t=await s.getBitcoinAddress(i,l,y,d,a),n=e?s.createDualWidgetHTML(t,e,d,M):s.createSingleWidgetHTML(t,d,M);c.innerHTML=n,e?await s.initializeDualWidget(t,e,d,M):await s.initializeSingleWidget(t,d,M)}catch(t){c.innerHTML='<div style="color: red; padding: 10px; border: 1px solid red; border-radius: 4px;">\n        Failed to load Bitcoin payment widget. Please check your configuration.\n      </div>'}}isLocalStorageAvailable(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch{return!1}}async copyToClipboard(t){if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(t),!0}catch{}const i=document.createElement("textarea");i.value=t,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.select();try{return document.execCommand("copy")}catch{return!1}finally{document.body.removeChild(i)}}async getBitcoinAddress(t,i,n,e,a){const o=Math.max(0,Math.min(e.cacheDuration,6048e5));if(this.isLocalStorageAvailable()){const t=localStorage.getItem(i),e=localStorage.getItem(n);if(t&&e){const i=parseInt(e);if(Date.now()-i<o)return t}}try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const a=await e.json();if(!a.address)throw new Error("Invalid response: no address field");return this.isLocalStorageAvailable()&&(localStorage.setItem(i,a.address),localStorage.setItem(n,Date.now().toString())),a.address}catch(t){if(a)return a;throw new Error(`Failed to fetch Bitcoin address: ${t.message}`)}}createSingleWidgetHTML(t,i,n){const e=`btc-btn-${n}`;return`\n      <div class="bitcoin-pay-widget">\n        <div class="widget-layout">\n          <div id="${`btc-qr-${n}`}" class="qr-container"></div>\n          <div class="content-area">\n            <p class="description">\n              Scan with your Bitcoin wallet, or copy the on-chain address below.\n            </p>\n            <div class="address-container">\n              <div class="address-text">\n                <span>${t}</span>\n              </div>\n              ${i.showCopyButton?`<button id="${e}" class="copy-btn">${i.copyButtonText}</button>`:""}\n            </div>\n          </div>\n        </div>\n      </div>\n    `}createDualWidgetHTML(t,i,n,e){const a=`lightning-qr-${e}`,o=`btc-btn-${e}`,c=`lightning-btn-${e}`;return`\n      <div class="bitcoin-pay-widget has-tabs">\n        <div class="widget-content">\n          \x3c!-- Tab Navigation --\x3e\n          <div class="tab-navigation">\n            <button id="bitcoin-tab-${e}" class="tab-btn active" data-tab="bitcoin">\n              <svg width="20" height="20" viewBox="0 0 64 64" fill="currentColor">\n                <g transform="translate(0.00630876,-0.00301984)">\n                  <path d="m63.033,39.744c-4.274,17.143-21.637,27.576-38.782,23.301-17.138-4.274-27.571-21.638-23.295-38.78,4.272-17.145,21.635-27.579,38.775-23.305,17.144,4.274,27.576,21.64,23.302,38.784z"/>\n                  <path fill="#FFF" d="m46.103,27.444c0.637-4.258-2.605-6.547-7.038-8.074l1.438-5.768-3.511-0.875-1.4,5.616c-0.923-0.23-1.871-0.447-2.813-0.662l1.41-5.653-3.509-0.875-1.439,5.766c-0.764-0.174-1.514-0.346-2.242-0.527l0.004-0.018-4.842-1.209-0.934,3.75s2.605,0.597,2.55,0.634c1.422,0.355,1.679,1.296,1.636,2.042l-1.638,6.571c0.098,0.025,0.225,0.061,0.365,0.117-0.117-0.029-0.242-0.061-0.371-0.092l-2.296,9.205c-0.174,0.432-0.615,1.08-1.609,0.834,0.035,0.051-2.552-0.637-2.552-0.637l-1.743,4.019,4.569,1.139c0.85,0.213,1.683,0.436,2.503,0.646l-1.453,5.834,3.507,0.875,1.439-5.772c0.958,0.26,1.888,0.5,2.798,0.726l-1.434,5.745,3.511,0.875,1.453-5.823c5.987,1.133,10.489,0.676,12.384-4.739,1.527-4.36-0.076-6.875-3.226-8.515,2.294-0.529,4.022-2.038,4.483-5.155zm-8.022,11.249c-1.085,4.36-8.426,2.003-10.806,1.412l1.928-7.729c2.38,0.594,10.012,1.77,8.878,6.317zm1.086-11.312c-0.990,3.966-7.1,1.951-9.082,1.457l1.748-7.01c1.982,0.494,8.365,1.416,7.334,5.553z"/>\n                </g>\n              </svg>\n              Bitcoin\n            </button>\n            <button id="lightning-tab-${e}" class="tab-btn" data-tab="lightning">\n              <svg width="20" height="20" viewBox="0 0 282 282" fill="currentColor">\n                <g clip-path="url(#clip0)">\n                  <circle cx="140.983" cy="141.003" r="141" />\n                  <path d="M79.7609 144.047L173.761 63.0466C177.857 60.4235 181.761 63.0466 179.261 67.5466L149.261 126.547H202.761C202.761 126.547 211.261 126.547 202.761 133.547L110.261 215.047C103.761 220.547 99.261 217.547 103.761 209.047L132.761 151.547H79.7609C79.7609 151.547 71.2609 151.547 79.7609 144.047Z" fill="white"/>\n                </g>\n                <defs>\n                  <clipPath id="clip0">\n                    <rect width="282" height="282" fill="white"/>\n                  </clipPath>\n                </defs>\n              </svg>\n              Lightning\n            </button>\n          </div>\n\n          \x3c!-- Bitcoin Tab Content --\x3e\n          <div id="bitcoin-content-${e}" class="tab-content active" data-tab="bitcoin">\n            <div class="widget-layout">\n              <div id="${`btc-qr-${e}`}" class="qr-container"></div>\n              <div class="content-area">\n                <p class="description">\n                  Scan with your Bitcoin wallet, or copy the on-chain address below.\n                </p>\n                <div class="address-container">\n                  <div class="address-text">\n                    <span>${t}</span>\n                  </div>\n                  ${n.showCopyButton?`<button id="${o}" class="copy-btn">${n.copyButtonText}</button>`:""}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Lightning Tab Content --\x3e\n          <div id="lightning-content-${e}" class="tab-content" data-tab="lightning">\n            <div class="widget-layout">\n              <div id="${a}" class="qr-container"></div>\n              <div class="content-area">\n                <p class="description">\n                  Scan with your Lightning wallet, or copy my Lightning address below.\n                </p>\n                <div class="address-container">\n                  <div class="address-text">\n                    <span>${i}</span>\n                  </div>\n                  ${n.showCopyButton?`<button id="${c}" class="copy-btn">Copy</button>`:""}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}async initializeSingleWidget(t,i,n){const e=`btc-qr-${n}`,a=`btc-btn-${n}`,o=new QRCodeStyling({width:i.width,height:i.height,type:i.qrCodeOptions.type,data:`bitcoin:${t}`,image:i.qrCodeOptions.bitcoinImage}),c=document.getElementById(e);if(c&&o.append(c),i.showCopyButton){const n=document.getElementById(a);n&&n.addEventListener("click",async()=>{const e=await this.copyToClipboard(t),a=n.textContent;n.textContent=e?i.copiedText:"Failed to copy",setTimeout(()=>{n.textContent=a},2e3)})}}async initializeDualWidget(t,i,n,e){const a=`btc-qr-${e}`,o=`lightning-qr-${e}`,c=`btc-btn-${e}`,s=`lightning-btn-${e}`,d=new QRCodeStyling({width:n.width,height:n.height,type:n.qrCodeOptions.type,data:`bitcoin:${t}`,image:n.qrCodeOptions.bitcoinImage}),M=document.getElementById(a);M&&d.append(M);const r=new QRCodeStyling({width:n.width,height:n.height,type:n.qrCodeOptions.type,data:`lightning:${i}`,image:n.qrCodeOptions.lightningImage}),l=document.getElementById(o);if(l&&r.append(l),this.setupTabs(e),n.showCopyButton){const e=document.getElementById(c);e&&e.addEventListener("click",async()=>{const i=await this.copyToClipboard(t),a=e.textContent;e.textContent=i?n.copiedText:"Failed to copy",setTimeout(()=>{e.textContent=a},2e3)});const a=document.getElementById(s);a&&a.addEventListener("click",async()=>{const t=await this.copyToClipboard(i),e=a.textContent;a.textContent=t?n.copiedText:"Failed to copy",setTimeout(()=>{a.textContent=e},2e3)})}}setupTabs(t){const i=document.querySelectorAll(`.tab-btn[id$="-${t}"]`),n=document.querySelectorAll(`.tab-content[id$="-${t}"]`);i.forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-tab");i.forEach(t=>{t.classList.remove("active")}),t.classList.add("active"),n.forEach(t=>{t.classList.remove("active"),t.getAttribute("data-tab")===e&&t.classList.add("active")})})})}generateInstanceId(){return Math.random().toString(36).substr(2,9)}}"undefined"!=typeof window&&(window.BitcoinPay=BitcoinPay);export{BitcoinPay};export default BitcoinPay;